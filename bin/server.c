/* ++++++++++++++++++++++++REVERSE TRACEROUTE SERVER++++++++++++++++++++++++ */ /* ================================= Headers =============================== */#include<stdio.h>#include<stdlib.h>#include<string.h>#include<sys/types.h>#include<sys/socket.h>#include<netinet/in.h>#include<errno.h>#include<fcntl.h>#include<unistd.h>/* ================================== Macros =============================== */#define PORT_NO 7007#define MAX_FILE_LENGTH 4000#define MAX_CMD_LENGTH 256/* ==============================Global variables=========================== */	struct sockaddr_in serv_addr,clin_addr;	char xcmd[MAX_CMD_LENGTH],cmd[MAX_CMD_LENGTH],c_addr[INET_ADDRSTRLEN];/* ============================== Functions ================================ */int accept_connection(int sockfd)	{	int newsockfd,clienlen;	clienlen = sizeof(clin_addr);	newsockfd = accept(sockfd,(struct sockaddr*)&clin_addr,&clienlen);  	// Accept the Request 	if(newsockfd == -1)	{		perror("Accept function failed");		exit(1);	}		return newsockfd;}void read_query(int socket)	{	int err;	bzero(cmd,MAX_CMD_LENGTH-1); 						// Clear memory for incoming data	err = read(socket,cmd,MAX_CMD_LENGTH-1);				// Read query from established connection	if(err == -1)	{		perror("Read function failed");	}}int init_socket()	{	int sockfd,err ;	sockfd = socket(AF_INET,SOCK_STREAM,0); 				// Creating socket	bzero((char*)&serv_addr,sizeof(serv_addr)); 				// Clear memory of the structure variable		serv_addr.sin_family=AF_INET;						// Initialize structure variable	serv_addr.sin_addr.s_addr=INADDR_ANY;	serv_addr.sin_port=htons(PORT_NO);	err = bind(sockfd,(struct sockaddr *)&serv_addr,sizeof(serv_addr)); 	// Binding ADDR and PORT	if(err == -1)	{		perror("error in binding");		exit(1);	}	return sockfd;}void create_query()	{	int i,j;	for(i=0;cmd[i]!='\0';i++)	{		xcmd[i]=cmd[i];	}	xcmd[i++]=' ';	for(j=0;c_addr[j]!='\0';j++)	{		xcmd[i++]=c_addr[j];	}	strcat(xcmd," >");	strcat(xcmd,c_addr);}	int main(int argc, char **argv)		{	int err,e,fd,sockfd,newsockfd,i,j;	char c[MAX_FILE_LENGTH]; 		sockfd = init_socket();	e = listen(sockfd,5); 							// Maximum number of connections	if(e == -1)	{		perror("error in listening");		exit(1);	} 	newsockfd = accept_connection(sockfd);	inet_ntop(AF_INET, &(clin_addr.sin_addr),c_addr, INET_ADDRSTRLEN);	// Convert IP addr from network bites to string  	read_query(newsockfd);	create_query();		system(xcmd); 								// Process Request...	fd = open(c_addr,O_RDONLY,0);	if(fd == -1)	{		perror("Open function failed");		exit(1);	}	err = read(fd,c,MAX_FILE_LENGTH-1);	if(err == -1)	{		perror("Read function failed");		exit(1);	}	e = send(newsockfd,c,MAX_FILE_LENGTH-1,0); 				// Send the Output...	if(e == -1)	{		perror("error in sending");		exit(1);	}	close(newsockfd);	return 0;}